<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>World Food Finder</title>
  <meta name="description" content="Responsive prototype: World Food Finder - search cuisines, filter, view on map, save favorites." />
  <!-- Leaflet CSS (for map) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <style>
    /* Mobile-first responsive CSS */
    :root{
      --accent:#EF6C00;
      --muted:#6b7280;
      --card:#ffffff;
      --bg:#f8fafc;
      --glass: rgba(255,255,255,0.7);
    }
    *{box-sizing:border-box;}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;color:#0f172a;background:var(--bg);}
    .app{max-width:1100px;margin:18px auto;padding:12px;}

    header{display:flex;gap:12px;align-items:center;justify-content:space-between;}
    .brand{display:flex;gap:10px;align-items:center;}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#ffb86b);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;}
    h1{font-size:1.1rem;margin:0;}
    p.lead{margin:0;color:var(--muted);font-size:.85rem;}

    .controls{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap;}
    .search{flex:1;display:flex;gap:8px;}
    .search input{flex:1;padding:10px 12px;border-radius:10px;border:1px solid #e6e9ee;background:transparent;}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;border:none;background:var(--accent);color:white;font-weight:600;cursor:pointer;}
    .btn.secondary{background:transparent;color:var(--accent);border:1px solid rgba(239,108,0,0.15);}

    .layout{display:grid;grid-template-columns:1fr;gap:12px;margin-top:14px;}
    @media(min-width:880px){.layout{grid-template-columns:420px 1fr;}}

    .panel{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 6px 20px rgba(15,23,42,0.06);}

    .filters{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;}
    .chip{padding:8px 10px;border-radius:999px;border:1px solid #e6e9ee;background:var(--glass);font-size:.85rem;cursor:pointer;}
    .chip.active{background:var(--accent);color:white;border:none;}

    .results{display:flex;flex-direction:column;gap:10px;}
    .card{display:flex;gap:10px;padding:10px;border-radius:10px;align-items:center;}
    .card .thumb{width:76px;height:76px;border-radius:8px;background:#eee;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--muted);}
    .card .meta{flex:1;}
    .card h3{margin:0;font-size:.98rem;}
    .meta p{margin:6px 0 0;color:var(--muted);font-size:.85rem;}
    .card .actions{display:flex;gap:6px;align-items:center;}

    .mapwrap{height:54vh;border-radius:12px;overflow:hidden;}
    #map{height:100%;min-height:320px;}

    .results-empty{padding:22px;text-align:center;color:var(--muted);}

    /* Modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:none;align-items:center;justify-content:center;padding:18px;}
    .modal{background:white;border-radius:12px;max-width:720px;width:100%;padding:16px;}
    .modal.show{display:block;}

    /* small helpers */
    .row{display:flex;gap:8px;align-items:center;}
    .muted{color:var(--muted);}
    .rating{font-weight:700;color:#f59e0b;}

    /* responsive tweaks */
    @media(max-width:600px){
      .logo{width:40px;height:40px;}
      header{gap:8px;}
      .mapwrap{height:38vh;}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo">WF</div>
        <div>
          <h1>World Food Finder</h1>
          <p class="lead">Find cuisines, local dishes, and places near you — prototype</p>
        </div>
      </div>
      <div class="actions">
        <button id="toggleMapBtn" class="btn secondary">Toggle map</button>
        <button id="favoritesBtn" class="btn">Favorites</button>
      </div>
    </header>

    <div class="controls">
      <div class="search">
        <input id="searchInput" type="search" placeholder="Search dishes, cuisine, city — e.g. biryani, ramen, Seoul" aria-label="Search" />
        <button id="searchBtn" class="btn">Search</button>
      </div>
      <select id="sortSelect" class="chip" aria-label="Sort results">
        <option value="relevance">Sort: Relevance</option>
        <option value="rating">Sort: Rating</option>
        <option value="distance">Sort: Distance</option>
      </select>
    </div>

    <main class="layout">
      <aside class="panel">
        <div class="row">
          <strong>Filters</strong>
          <small class="muted">(tap to toggle)</small>
        </div>
        <div class="filters" id="filterList">
          <!-- chips injected -->
        </div>

        <div style="margin-top:12px">
          <strong>Results</strong>
          <div id="results" class="results" style="margin-top:8px">
            <!-- results injected here -->
          </div>
          <div id="resultsEmpty" class="results-empty" style="display:none">No results. Try different keywords or remove filters.</div>
        </div>
      </aside>

      <section>
        <div class="panel mapwrap" id="mapPanel">
          <div id="map"></div>
        </div>
      </section>
    </main>
  </div>

  <!-- Modal -->
  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document">
      <button id="closeModal" class="btn secondary" style="float:right">Close</button>
      <h2 id="mdlTitle">Place</h2>
      <p id="mdlDesc" class="muted"></p>
      <div style="margin-top:8px" id="mdlExtra"></div>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script>
    /* Sample dataset - in a real app you'd fetch from API */
    const DATA = [
      {id:1,name:'Dhaka Biryani House',cuisine:'Biryani',city:'Dhaka',rating:4.6,coords:[23.7104,90.4074],desc:'Legendary beef & chicken biryani.'},
      {id:2,name:'Tokyo Ramen Lab',cuisine:'Ramen',city:'Tokyo',rating:4.7,coords:[35.6895,139.6917],desc:'Rich tonkotsu bowls.'},
      {id:3,name:'Seoul Kimchi Corner',cuisine:'Korean',city:'Seoul',rating:4.4,coords:[37.5665,126.9780],desc:'Homestyle kimchi and BBQ.'},
      {id:4,name:'Mumbai Vada Pav',cuisine:'Street',city:'Mumbai',rating:4.2,coords:[19.0760,72.8777],desc:'Crunchy vada pav & chai.'},
      {id:5,name:'Istanbul Kebab Hub',cuisine:'Turkish',city:'Istanbul',rating:4.5,coords:[41.0082,28.9784],desc:'Doner and fresh flatbreads.'},
      {id:6,name:'Lima Ceviche Spot',cuisine:'Peruvian',city:'Lima',rating:4.8,coords:[-12.0464,-77.0428],desc:'Zesty ceviche with aji.'}
    ];

    // App state
    const state = {
      query:'',
      filter: null, // e.g. 'Biryani'
      sort:'relevance',
      showMap:true,
      favorites: new Set(JSON.parse(localStorage.getItem('wf:favs')||'[]')),
      map:null,
      markers: []
    };

    // Elements
    const filterList = document.getElementById('filterList');
    const resultsEl = document.getElementById('results');
    const resultsEmpty = document.getElementById('resultsEmpty');
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const sortSelect = document.getElementById('sortSelect');
    const toggleMapBtn = document.getElementById('toggleMapBtn');
    const mapPanel = document.getElementById('mapPanel');
    const favoritesBtn = document.getElementById('favoritesBtn');

    // Modal
    const modalBackdrop = document.getElementById('modalBackdrop');
    const closeModal = document.getElementById('closeModal');
    const mdlTitle = document.getElementById('mdlTitle');
    const mdlDesc = document.getElementById('mdlDesc');
    const mdlExtra = document.getElementById('mdlExtra');

    function uniqueCuisines(data){
      const s=new Set(); data.forEach(d=>s.add(d.cuisine)); return Array.from(s);
    }

    function renderFilters(){
      const cuisines = uniqueCuisines(DATA);
      filterList.innerHTML='';
      cuisines.forEach(c=>{
        const btn = document.createElement('button');
        btn.className='chip'+(state.filter===c? ' active':'');
        btn.textContent=c;
        btn.addEventListener('click',()=>{state.filter = state.filter===c? null : c; render();});
        filterList.appendChild(btn);
      });
    }

    function distanceApprox(a,b){
      // crude distance (Haversine would be better). Used only when sorting by distance but without user location, fallback to 0.
      if(!a||!b) return 0; const toR = Math.PI/180; const [lat1,lon1]=a; const [lat2,lon2]=b; const R=6371; const dLat=(lat2-lat1)*toR; const dLon=(lon2-lon1)*toR; const A=Math.sin(dLat/2)**2 + Math.cos(lat1*toR)*Math.cos(lat2*toR)*Math.sin(dLon/2)**2; const C=2*Math.atan2(Math.sqrt(A),Math.sqrt(1-A)); return R*C;
    }

    function renderResults(){
      let list = DATA.slice();
      // filter by query
      const q = state.query.trim().toLowerCase();
      if(q){
        list = list.filter(d=> (d.name+ ' ' + d.cuisine + ' ' + d.city + ' ' + d.desc).toLowerCase().includes(q));
      }
      if(state.filter) list = list.filter(d=>d.cuisine===state.filter);

      // sort
      if(state.sort==='rating') list.sort((a,b)=>b.rating-a.rating);
      else if(state.sort==='distance'){
        // If navigator geolocation available, sort by real distance. otherwise maintain order.
        if(state.userCoords){
          list.sort((a,b)=>distanceApprox(a.coords,state.userCoords)-distanceApprox(b.coords,state.userCoords));
        }
      }

      // render
      resultsEl.innerHTML='';
      if(list.length===0){resultsEmpty.style.display='block'; return;}
      resultsEmpty.style.display='none';

      list.forEach(item=>{
        const card = document.createElement('div'); card.className='card panel';
        const thumb = document.createElement('div'); thumb.className='thumb'; thumb.textContent=item.cuisine[0];
        const meta = document.createElement('div'); meta.className='meta';
        const h = document.createElement('h3'); h.textContent=item.name + ' '; const spanRate=document.createElement('span'); spanRate.className='rating'; spanRate.textContent='★ '+item.rating; spanRate.style.fontSize='0.9rem'; h.appendChild(spanRate);
        const p = document.createElement('p'); p.className='muted'; p.textContent = item.cuisine + ' • ' + item.city;
        meta.appendChild(h); meta.appendChild(p);
        const actions = document.createElement('div'); actions.className='actions';
        const details = document.createElement('button'); details.className='btn secondary'; details.textContent='Details'; details.addEventListener('click',()=>openModal(item));
        const fav = document.createElement('button'); fav.className='btn'; fav.textContent = state.favorites.has(item.id)? 'Saved' : 'Save'; fav.addEventListener('click',()=>toggleFav(item,fav));
        actions.appendChild(details); actions.appendChild(fav);
        card.appendChild(thumb); card.appendChild(meta); card.appendChild(actions);
        resultsEl.appendChild(card);
      });
    }

    function openModal(item){
      mdlTitle.textContent = item.name;
      mdlDesc.textContent = item.desc;
      mdlExtra.innerHTML = `<div class="row"><strong>Rating:</strong> <div style="margin-left:8px">${item.rating} / 5</div></div><div style="margin-top:8px"><strong>City:</strong> ${item.city}</div>`;
      modalBackdrop.style.display='flex'; modalBackdrop.setAttribute('aria-hidden','false');
      // center map on marker if map is visible
      if(state.map){ state.map.setView(item.coords, 12, {animate:true}); }
    }

    closeModal.addEventListener('click',()=>{modalBackdrop.style.display='none'; modalBackdrop.setAttribute('aria-hidden','true');});
    modalBackdrop.addEventListener('click', (e)=>{ if(e.target===modalBackdrop){ modalBackdrop.style.display='none'; modalBackdrop.setAttribute('aria-hidden','true'); } });

    function toggleFav(item, btnEl){
      if(state.favorites.has(item.id)){ state.favorites.delete(item.id); btnEl.textContent='Save'; }
      else { state.favorites.add(item.id); btnEl.textContent='Saved'; }
      localStorage.setItem('wf:favs', JSON.stringify(Array.from(state.favorites)));
    }

    favoritesBtn.addEventListener('click', ()=>{
      // show only favorites
      state.query=''; searchInput.value='';
      const favIds = Array.from(state.favorites);
      if(favIds.length===0){ alert('No favorites yet. Save places from results.'); return; }
      const favList = DATA.filter(d=>favIds.includes(d.id));
      resultsEl.innerHTML='';
      favList.forEach(item=>{
        const card = document.createElement('div'); card.className='card panel';
        const thumb = document.createElement('div'); thumb.className='thumb'; thumb.textContent=item.cuisine[0];
        const meta = document.createElement('div'); meta.className='meta';
        const h = document.createElement('h3'); h.textContent=item.name + ' '; const spanRate=document.createElement('span'); spanRate.className='rating'; spanRate.textContent='★ '+item.rating; h.appendChild(spanRate);
        const p = document.createElement('p'); p.className='muted'; p.textContent = item.cuisine + ' • ' + item.city;
        meta.appendChild(h); meta.appendChild(p);
        const actions = document.createElement('div'); actions.className='actions';
        const details = document.createElement('button'); details.className='btn secondary'; details.textContent='Details'; details.addEventListener('click',()=>openModal(item));
        const fav = document.createElement('button'); fav.className='btn'; fav.textContent = 'Remove'; fav.addEventListener('click',()=>{ state.favorites.delete(item.id); localStorage.setItem('wf:favs', JSON.stringify(Array.from(state.favorites))); render(); });
        actions.appendChild(details); actions.appendChild(fav);
        card.appendChild(thumb); card.appendChild(meta); card.appendChild(actions);
        resultsEl.appendChild(card);
      });
    });

    searchBtn.addEventListener('click', ()=>{ state.query = searchInput.value; render(); });
    searchInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ state.query = searchInput.value; render(); } });
    sortSelect.addEventListener('change', ()=>{ state.sort = sortSelect.value; render(); });
    toggleMapBtn.addEventListener('click', ()=>{ state.showMap = !state.showMap; mapPanel.style.display = state.showMap? 'block' : 'none'; toggleMapBtn.textContent = state.showMap? 'Hide map':'Show map'; if(state.showMap && state.map) state.map.invalidateSize(); });

    function initMap(){
      try{
        state.map = L.map('map').setView([20,0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom:19, attribution:'© OpenStreetMap'}).addTo(state.map);
        drawMarkers(DATA);
      }catch(e){ console.warn('map init failed',e); document.getElementById('map').innerHTML='Map failed to load.'; }
    }

    function drawMarkers(list){
      // clear
      state.markers.forEach(m=>state.map.removeLayer(m)); state.markers=[];
      list.forEach(item=>{
        const m = L.marker(item.coords).addTo(state.map).bindPopup(`<strong>${item.name}</strong><br>${item.cuisine} • ${item.city}`);
        state.markers.push(m);
      });
    }

    function renderMapFromResults(){
      // redraw markers for displayed results (basic sync)
      const nodes = Array.from(resultsEl.children);
      // find IDs from titles
      const visibleNames = nodes.map(n=>n.querySelector('h3').childNodes[0].textContent.trim());
      const visible = DATA.filter(d=>visibleNames.includes(d.name));
      if(state.map) drawMarkers(visible);
      if(visible.length>0 && state.map){ state.map.fitBounds(visible.map(i=>i.coords),{padding:[40,40]}); }
    }

    function render(){
      renderFilters();
      renderResults();
      renderMapFromResults();
    }

    // Try to get user location to improve sorting by distance (optional)
    if(navigator.geolocation){
      navigator.geolocation.getCurrentPosition(pos=>{
        state.userCoords = [pos.coords.latitude,pos.coords.longitude];
      }, err=>{ /* ignore */ }, {timeout:5000});
    }

    // init
    render();
    initMap();

    // when results change we update markers
    const obs = new MutationObserver(()=>{ if(state.map) renderMapFromResults(); });
    obs.observe(resultsEl,{childList:true,subtree:false});

    // Accessibility: keyboard shortcut "/" to focus search
    window.addEventListener('keydown',(e)=>{ if(e.key==='/' && document.activeElement!==searchInput){ e.preventDefault(); searchInput.focus(); } });
  </script>
</body>
</html>
